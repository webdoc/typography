<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="author" content="">
	<meta name="description" content="">
	
	<title>Title</title>
	
	<script>document.documentElement.className = 'js';</script>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
	<!-- Force latest IE rendering engine & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<!-- Make IE recognise HTML5 elements for styling -->
	<!--[if lte IE 8]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!-- Disable image toolbar in IE6 -->
	<!--[if lte IE 6]><meta http-equiv="imagetoolbar" content="no" /><![endif]-->
	
	<!--link rel="icon" type="image/png" href="images/favicon.png" />
	<link rel="apple-touch-icon" href="/apple-touch-icon.png"-->
	
	<link rel="stylesheet" type="text/css" href="css/template.reset.css" />
	<link rel="stylesheet" type="text/css" href="css/template.typography.css" />
	<link rel="stylesheet" type="text/css" href="css/template.forms.css" />
	<link rel="stylesheet" type="text/css" href="css/template.classes.css" />
	<!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="css/template.ie.css" /><![endif]-->
	<!--[if IE 8]><link rel="stylesheet" type="text/css" href="css/template.ie8.css" /><![endif]-->
	<!--[if IE 7]><link rel="stylesheet" type="text/css" href="css/template.ie7.css" /><![endif]-->
	<!--[if IE 6]><link rel="stylesheet" type="text/css" href="css/template.ie6.css" /><![endif]-->
	<link rel="stylesheet" type="text/css" href="css/template.typography.12_20.css" />
	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Dancing+Script|Ubuntu:b,i,bi|Just+Another+Hand|Chewy|Schoolbell|Merriweather|Puritan:i,b,bi|Cabin:i,b,bi|Tangerine:b|Coda:800|Droid+Serif:b|Droid+Sans:b|Irish+Growler|Lobster|Yanone+Kaffeesatz:200,300,400,700|Neucha|Arvo:i,b,bi" />
	
	<style>
		body {
			background-image: url('test/images/grid_20px.png');
		}
		
		table {
			background-color: white;
		}
		
		td {
			position: relative;
		}
		
		thead td {
			vertical-align: bottom;
		}
		
		.mark {
			display: inline-block;
			line-height: 0;
			font-size: 0;
			vertical-align: baseline;
			position: relative;
		}
		
		.dot {
			position: absolute;
			display: block;
			width: 10px;
			height: 10px;
			background-color: red;
		}
		
		.head {
			background-color: rgba(63,63,63,0.2);
		}
		
		.pass {
			background-color: rgba(160,255,63,0.4);
		}

		.fail {
			background-color: rgba(255,127,0,0.5);
		}
		
		.test {
			position: absolute;
			/*float: left;
			clear: left;*/
			margin-bottom: 0;
			font-family: Helvetica,Arial,sans-serif;
			/*white-space: nowrap;*/
		}
		
		.new {
			border-left: 1px solid grey;
		}
		
		.note {
			position: absolute;
		}
	</style>
</head>

<body>
	
	<script src="js/js.extensions.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
	<script>!window.jQuery && document.write(unescape('%3Cscript src="js/jquery.js"%3E%3C/script%3E'));</script>
	<script src="js/jquery.extensions.js"></script>
	<script src="js/jquery.event.activate.js"></script>
	<script src="js/jquery.validator.js"></script>
	<script src="js/jquery.transitions.js"></script>
	<script src="js/jquery.loading.js"></script>
	<script src="js/jquery.popup.js"></script>
	<script src="js/template.ui.js"></script>
	<script src="js/js.details.js"></script>
	
	<script type="text/javascript">
		(function(){
			var fonts = [
			    	"Arial",
			    	"Times",
			    	"Times New Roman",
			    	"Trebuchet",
			    	"Georgia",
			    	"Courier",
			    	"Dancing Script",
			    	"Ubuntu",
			    	"Just Another Hand",
			    	"Chewy",
			    	"Schoolbell",
			    	"Merriweather",
			    	"Puritan",
			    	"Cabin",
			    	"Tangerine",
			    	"Coda",
			    	"Droid Serif",
			    	"Droid Sans",
			    	"Irish Growler",
			    	"Lobster",
			    	"Yanone Kaffeesatz",
			    	"Neucha",
			    	"Arvo"
			    ],
			    
			    sizes = [
			    	'9px',
			    	'12px',
			    	'15px',
			    	'18px',
			    	'21px',
			    	'24px',
			    	'27px',
			    	'30px'
			    ],
			    
			    lineheights = [
			    	'1.3333334',
			    	'1.3333333',
			    	'1.333334',
			    	'1.333333',
			    	'1.33334',
			    	'1.33333',
			    	'1.34',
			    	'1.33'
			    ],
			    
			    test = '<div class="test" style="line-height: {{lineheight}};"><p><span style="font-family: {{font}}; font-size: {{size}};" class="fred">' +
			    	'The quick brown fox jumps over the lazy dog.<br/>' +
			    	'The quick brown fox jumps over the lazy dog.<br/>' +
			    	'The quick brown fox jumps over the lazy dog.<br/>' +
			    	'The quick brown fox jumps over the lazy dog.<br/>' +
			    	'The quick brown fox jumps over the lazy dog.<br/>' +
			    	'</span></p></div>',
			    
			    row = '<tr class="{{class}}"><td>{{font}}</td>{{rowdata}}<td>{{width}}</td></tr>',
			    
			    rowdata = '<td class="new">{{wrap}}</td><td class="{{class}}">{{span}}</td><td class="{{class}}">{{average}}</td>';
			
			function setupFont(body, font, lineheight, size) {
				var elem = jQuery(jQuery.render(test, {
					font: font,
					size: size,
					lineheight: lineheight
				}));
				
				body.append(elem);
				
				return {
					elem: elem
				};
			}
			
			function setupFonts(body, fonts, lineheights, size) {
				var l = fonts.length,
						result = {},
						m, font, lineheight;
				
				// Loop through fonts
				while (l--) {
					font = fonts[l];
					result[font] = {};
					m = lineheights.length;
					
					// Loop through lineheights
					while (m--) {
						lineheight = lineheights[m];
						result[font][lineheight] = setupFont(body, font, lineheight, size);
					}
				}
				
				return result;
			}
			
			function checkFonts(fonts, lineheights, data) {
				var l = fonts.length,
				    result = {},
				    m, elem, font, lineheight, fontData;
				
				// Loop through fonts
				while (l--) {
					font = fonts[l];
					data.font = font;
					fontData = data[font];
					m = lineheights.length;
					
					// Loop through lineheights
					while (m--) {
						lineheight = lineheights[m];
						
						elem = fontData[lineheight].elem;
						
						data[font]['lineheight'+lineheight] = parseInt(elem.css('line-height'));
						data[font]['spanheight'+lineheight] = parseInt(elem.find('.fred').css('line-height'));
						data[font]['height'+lineheight] = elem.height()/5;
						data[font]['width'+lineheight] = elem.width();
						data[font]['class'+lineheight] = (data[font]['spanheight'+lineheight] === data[font]['height'+lineheight]) ? 'pass' : 'fail';
					}
				}
			}
			
			function populateResults(table, data, size) {
				var html = '',
				    key;
				
				// Render table head
				html += ['<thead>', jQuery.render(row, {
					font: size + ' font',
					
					rowdata: (function(data){
						var html = '',
						    m = lineheights.length;
						
						// Loop over lineheights
						while (m--) {
							html += jQuery.render(rowdata, {
								wrap: '<span class="note">'+lineheights[m]+'</span><br/>item',
								span: 'span',
								average: 'mean',
								'class': ''
							});
						}
						
						return html;
					})(data),
					
					width: 'width',
					'class': 'head'
				}), '</thead>'].join('');
				
				
				// Render table body
				html += '<tbody>';
				
				for (key in data) {
					html += jQuery.render(row, {
						font: key,
						
						rowdata: (function(data){
							var html = '',
							    m = lineheights.length;
							
							// Loop over lineheights
							while (m--) {
								html += jQuery.render(rowdata, {
									wrap:     data['lineheight'+lineheights[m]],
									span:     data['spanheight'+lineheights[m]],
									average:  data['height'+lineheights[m]],
									'class':  data['class'+lineheights[m]]
								});
							}
							
							return html;
						})(data[key]),
						
						width: 0
					});
				}
				
				html += '</tbody>';
				
				table.html(html);
			}
			
			
			
			jQuery(document).ready(function(){
				var body = jQuery('body'),
				    m = sizes.length,
				    data, table;
				
				while (m--) {
					data = setupFonts(body, fonts, lineheights, sizes[m]);
					table = jQuery('<table/>');
					
					(function(data, table, size) {
						setTimeout(function(){
							checkFonts(fonts, lineheights, data);
							populateResults(table, data, size);
							body.prepend(table);
						}, 1000);
					})(jQuery.extend({}, data), table, sizes[m]);
				}
			});
		})();
	</script>
</body>
</html>